#!/usr/bin/env -S ruby -Eutf-8

require "bundler/setup"
require_relative "../lib/lifer"
require_relative "../lib/lifer/cli"

parser = Lifer::CLI::ArgumentParser.new(input: ARGV)
args = parser.output
subcommand = parser.subcommand
subcommand = :help if args[:h] || args[:help]

case subcommand
when :build, nil then Lifer.build!
when :help
  puts <<~HELP_TEXT
    Lifer, the static site generator

    Usage:
      lifer [subcommand]

    Subcommands:
      build: Build the Lifer project as configured in your Lifer configuration file.
      serve: Run a Lifer development server.
  HELP_TEXT
when :serve
  Lifer.build!

  require "lifer/dev/server"

  Lifer::Dev::Server.start!
end
